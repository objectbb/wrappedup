(function() {
    angular.module('wrappedup.app', ['ui.bootstrap']).
    filter('filterrequest', function() {
        return function(items) {
            var filtered = [];

             for(var key in items){  
                var item = items[key];
                if (/true/.test(item)) {
                    filtered.push(key);
                }
            }
            return filtered;
        };
    }).config(['$httpProvider', function($httpProvider) {
        // Intercept POST requests, convert to standard form encoding
        $httpProvider.defaults.headers.post["Content-Type"] = "application/x-www-form-urlencoded";
        $httpProvider.defaults.transformRequest.unshift(function(data, headersGetter) {
            var key, result = [];
            for (key in data) {
                if (data.hasOwnProperty(key)) {
                    result.push(encodeURIComponent(key) + "=" + encodeURIComponent(data[key]));
                }
            }
            return result.join("&");
        })
    }]);
}());
(function() {
    angular.module('wrappedup.app').controller('DatepickerCtrl', function($scope, $modal, $log) {
        $scope.dt = new Date();
        $scope.minDate = new Date();
        $scope.open = function() {
            var modalInstance = $modal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'signup.html',
                controller: 'ModalInstanceCtrl',
                size: 'lg',
                resolve: {
                    items: function() {
                        return $scope.dt;
                    }
                }
            });
           
            modalInstance.result.then(function(selectedItem) {
                $scope.selected = selectedItem;
            }, function() {
                $log.info('Modal dismissed at: ' + new Date());
            });
        };



   $scope.schedule = function() {
            var modalInstance = $modal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'schedule.html',
                controller: 'ModalInstanceCtrl',
                size: 'lg',
                resolve: {
                    items: function() {
                        return $scope.request;
                    }
                }
            });
           
            modalInstance.result.then(function(selectedItem) {
                $scope.selected = selectedItem;
            }, function() {
                $log.info('Modal dismissed at: ' + new Date());
            });
        };



    });
})();
(function() {
    angular.module('wrappedup.app').controller('CarouselCtrl', function($scope, $modal, $log) {
         var slides = $scope.slides = [{image: './images/carousel/pinkcar.jpg', text:''}, 
                            {image: './images/carousel/slide1.jpg', text:''}];
    });
})();
(function() {
    angular.module('wrappedup.app').controller('ModalInstanceCtrl', ['$scope', '$modalInstance', 'items', 'RequestService',
        function($scope, $modalInstance, items, RequestService) {
            $scope.items = items;
            $scope.issent = -1;
            $scope.ok = function() {
                $modalInstance.close($scope.selected.item);
            };
            $scope.cancel = function() {
                $scope.request = null;
                $modalInstance.dismiss('cancel');
            };
            $scope.clear = function() {
                $scope.request = null;
            };
            $scope.send = function() {

                var combined = angular.extend($scope.request,{ date: $scope.items.toString("MM/DD/YYYY")});
                RequestService.send(angular.extend(combined,$scope.info)).success(function(data, status) {
                    if (!data.error) $scope.issent = 1;
                    else $scope.issent = 0;
                });
            };
        }
    ]);
})();
(function() {
    angular.module('wrappedup.app').service('RequestService', ['$http', function($http) {

        return {
            send: function(data) {
                var urlrequest = "http://peaceful-lowlands-1646.herokuapp.com/web";
               //var urlrequest = "http://localhost:5000/web";

                return $http.post(urlrequest,{Body:  JSON.stringify(data)}).success(function(data){
                    return 1;
                }).error(function(err){
                    return 0;
                });
            }
        }
    }]);
})();